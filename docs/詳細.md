# ニュース収集・Slack共有支援 Webアプリ 詳細仕様（確定版 / MVP）

---

## 0. 目的（Why）

- システム開発・AI・社内業務に関係するニュースを効率よく把握する
- 「なぜ重要か / 何が起きそうか / どう動くべきか」を添えて、Slackで共有する回数と質を上げる
- 目標：Slackへの有益な共有を **1日3〜5件** 実現する

---

## 1. 全体方針（MVPの思想）

- 網羅性より **ノイズ削減と共有の量産** を優先
- 一覧は **新着順固定**（ランキングは補助情報として内部保持のみ）
- LLMは **共有文生成ボタン押下時のみ** 呼び出す（コスト最優先）
- 「自動投稿」はしない（最終判断とチャンネル選択は人が行う）

---

## 2. 技術スタック（Fix）

### 2.1 言語 / フレームワーク
- TypeScript
- React Router v7（Remix）
- 実行ランタイム：Node（Edgeは使わない前提）

### 2.2 DB
- Postgres（Supabase）

### 2.3 検索
- MVPは単純検索（LIKE）で実装
- 将来拡張：Postgres FTS など

### 2.4 デプロイ先
- Vercel（Web/API）
- Supabase（Postgres）
- Vercel Cron（RSS取得ジョブ）

### 2.5 監視・ログ
- MVPはログのみ（Sentry等は後回し）

### AI
- Vercel AI SDK
- LLMは環境変数で指定.

---

## 3. 認証（Fix）

### 3.1 方式
- アプリ内ログイン + **Session Cookie（HttpOnly）**

### 3.2 利用想定
- 個人利用（1ユーザー）
- ログインは単一パスワード（環境変数で管理）

### 3.3 セキュリティ要件
- Session Cookie は `HttpOnly`, `Secure(本番)`, `SameSite=Lax`
- 認証が必要なルートはすべてガードする

---

## 4. データ保持（Fix）

- 記事データは **約1年間保存**
- 一覧表示は **最新50件**
- 50件以降はページングで過去を閲覧可能

---

## 5. 入力（情報収集）要件（Fix）

### 5.1 ソース
- RSSのみ
- ソース数上限：10

### 5.2 取得頻度
- 1時間ごと

### 5.3 本文取得
- しない（スクレイピングはMVP非対象）
- 保存するのは RSS 由来の `title/description/link/publishedAt` を基本とする

---

## 6. タグ要件（Fix）

### 6.1 タグ数
- 初期10個程度

### 6.2 管理方法
- UIから追加・削除可能

### 6.3 タグ構造
- タグは「名前」だけでなく **キーワード配列**を持つ（重要）
  - 例：`AI` → `["AI","生成AI","LLM","ChatGPT","OpenAI"]`

### 6.4 タグ用途
- 記事のフィルタ・検索
- 記事の文脈付与
- Slack投稿文生成時の補助入力

---

## 7. ノイズ除外（Fix）

### 7.1 除外対象（ノイズ定義）
- 重複記事（URL一致・正規化）
- ゴシップ記事（MVPは自動判定しない／手動運用で対応）
- PR記事（MVPは自動判定しない／手動運用で対応）
- タイトル釣り（MVPは自動判定しない／手動運用で対応）
- **関心タグのキーワードを含まない記事（一次フィルタ）**

### 7.2 除外の扱い（重要）
- 完全削除はしない（DBには保持）
- UI上は **Excluded（隔離タブ）** に送る
- Excluded から Visible に戻せる

### 7.3 タグ一致判定
- 対象テキスト：`title + description`
- いずれのタグのキーワードにも一致しない場合は Excluded に分類する
- 一致したタグは保存し、UIに表示する

---

## 8. 重複判定（Fix）

- URL正規化のみで対応
  - `utm_*`, `fbclid`, `ref` 等のトラッキング系クエリを除去
- `canonicalUrl` が既存の場合は同一記事として取り込みをスキップ

---

## 9. 一覧・閲覧機能（Fix）

### 9.1 一覧表示
- 表示順：新着順（固定）
- 表示件数：50件
- ページングで過去へ遷移可能

### 9.2 一覧に表示する情報
- タイトル
- 日本語概要（短文）
- 公開日時
- 一致したタグ（matched tags）
- 外部リンク（本文へ遷移）

### 9.3 フィルタ / タブ
- All（表示対象）
- Excluded（除外タブ）
- Favorites（お気に入り）

### 9.4 操作
- お気に入り追加/解除
- 除外へ送る/戻す
- Slack共有文生成（モーダル表示）

---

## 10. 検索（Fix）

- タグ検索
- キーワード検索（LIKE）
- 検索対象：`title`, `description`

---

## 11. Slack投稿文生成（中核機能 / Fix）

### 11.1 生成タイミング
- ユーザーが「共有文生成」ボタンを押した時のみ

### 11.2 生成内容（3点に限定）
- なぜ自社にとって重要か
- 何が起きそうか（影響・変化）
- どんな行動につながりそうか（行動提案）

※ 部署・誰向けかは生成しない
※ 投稿チャンネルの判断もしない

### 11.3 生成フォーマット（固定）
- 箇条書き3行
- 文字数は短め

例：
```
・なぜ重要か：〇〇に影響が出る可能性がある
・起きそうなこと：△△の動きが加速しそう
・考えられる行動：関連情報を注視し、対応方針を整理する
```

### 11.4 生成入力
- 記事：`title`, `description`, `link`, `publishedAt`
- 一致タグ：タグ名 + キーワード（補助情報として）

### 11.5 UI要件
- 生成結果をモーダルで表示
- コピー（クリップボード）ボタン
- 必要なら軽微編集できるテキストエリア

---

## 12. LLMプロバイダ切り替え（Fix）

- 環境変数で切り替え可能にする
  - 例：`LLM_PROVIDER=openai|anthropic|azure`
- LLM呼び出しは共有文生成に限定（コスト制約のため）

---

## 13. Cron / バッチ（Fix）

### 13.1 実行方式
- Vercel Cron → HTTPエンドポイントを叩く

### 13.2 実行スケジュール
- 毎時ちょうど（例：`0 * * * *`）

### 13.3 保護
- `CRON_SECRET` による認証（ヘッダ or クエリ）

### 13.4 失敗時
- ログ出力のみ（監視は後回し）

---

## 14. 非ゴール（MVPではやらない）

- 自動Slack投稿
- RSS以外のソース（スクレイピング / SNS / ニュースAPI）
- 高度な推薦・埋め込み類似度
- 全記事の日本語翻訳・要約（共有文生成時のみLLM）
- SSO/OAuth 等の本格認証
- 組織向けマルチユーザー化

---

## 15. 成功指標（Fix）

- Slackに判断付きニュースを **毎日3〜5件** 投稿できている
- 「URLだけ貼る」投稿が減っている
- 記事選別〜投稿までの所要時間が短縮されている
